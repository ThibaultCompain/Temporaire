<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Force Directed Custom Nodes</title>
  <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/hierarchy.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
  <script src="https://cdn.amcharts.com/lib/5/plugins/exporting.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 14px;
        }
        
        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-group label {
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }
      
        .custom-tooltip {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            max-width: 400px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .custom-tooltip.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .tooltip-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .tooltip-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        
        .tooltip-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .tooltip-content {
            margin-bottom: 15px;
        }
        
        .tooltip-field {
            margin: 8px 0;
            font-size: 14px;
        }
        
        .tooltip-field strong {
            color: #495057;
        }
        
        .tooltip-link {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .tooltip-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        #chartdiv {
            width: 100%;
            height: 85vh;
            background: #fafbfc;
        }
        
        .info-panel {
            padding: 20px 30px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
        }
    </style>
</head>
<body>
	<div class="header">
		<h1>Objets exposés du Hub CCT</h1>
	</div>
	<div id="chartdiv"></div>
	<div class="controls">
		<div class="control-group">
			<label>Jeu de données :</label>
			<select id="datasetSelect">
				<option value="sample1">Exemple - Système CRM</option>
				<option value="sample2">Exemple - Data Warehouse</option>
				<option value="sample3">Exemple - Analytics Platform</option>
			</select>
		</div>
	</div>

<!-- Tooltip personnalisé -->
<div id="customTooltip" class="custom-tooltip">
	<div class="tooltip-header">
		<span class="tooltip-title" id="tooltipTitle"></span>
		<button class="tooltip-close" onclick="hideCustomTooltip()">×</button>
	</div>
	<div class="tooltip-content" id="tooltipContent"></div>
	<div id="tooltipActions"></div>
</div>


  <script>
  am5.ready(function () {
    var root = am5.Root.new("chartdiv");
    root.setThemes([am5themes_Animated.new(root)]);

    var zoomableContainer = root.container.children.push(
      am5.ZoomableContainer.new(root, {
        width: am5.p100,
        height: am5.p100,
        pinchZoom: true
      })
    );

    zoomableContainer.children.push(am5.ZoomTools.new(root, {
      target: zoomableContainer
    }));

    // Exemple de dataset
    var data = {
      value: 0,
      children: [
        { name: "Cercle", value: 5, color: "#e74c3c", shape: "circle", link: "https://www.google.com" },
        { name: "Hexagone", value: 5, color: "#2ecc71", shape: "hexagon", link: "https://www.amcharts.com" },
        { name: "Carré", value: 5, color: "#3498db", shape: "square", link: "https://github.com" },
        { name: "Losange", value: 5, color: "#9b59b6", shape: "diamond", link: "https://openai.com" },
        { name: "Triangle", value: 5, color: "#f39c12", shape: "triangle", link: "https://anthropic.com" }
      ]
    };

    var series = zoomableContainer.contents.children.push(
      am5hierarchy.ForceDirected.new(root, {
        valueField: "value",
        categoryField: "name",
        childDataField: "children",
        idField: "name",
        manyBodyStrength: -30,
        centerStrength: 0.6
      })
    );

    // Rendre les cercles invisibles (on dessine par-dessus)
    series.circles.template.setAll({
      fillOpacity: 0,
      strokeOpacity: 0
    });

    // Labels uniformes
    series.labels.template.setAll({
      text: "{name}",
      fontSize: 14,
      fontWeight: "600",
      fill: am5.color("#fff"),
      centerX: am5.p50,
      centerY: am5.p50,
      textAlign: "center",
      oversizedBehavior: "fit"
    });

    // Tooltip HTML avec lien
    series.nodes.template.set("tooltipHTML", function (target) {
      let ctx = target.dataItem.dataContext;
      if (ctx.link) {
        return `<strong>${ctx.name}</strong><br><a href="${ctx.link}" target="_blank">Ouvrir lien</a>`;
      }
      return `<strong>${ctx.name}</strong>`;
    });

    // Gestion des formes custom
    series.nodes.template.events.on("dataitemchanged", function (ev) {
      let node = ev.target;
      let ctx = node.dataItem.dataContext;

      node.children.each(child => child.dispose()); // clean
      let size = 30;
      let color = am5.color(ctx.color || "#667eea");
      let shape;

      if (ctx.shape === "hexagon") {
        shape = am5.Graphics.new(root, {
          draw: function (display) {
            display.moveTo(size * Math.cos(0), size * Math.sin(0));
            for (let i = 1; i <= 6; i++) {
              display.lineTo(
                size * Math.cos((i * Math.PI) / 3),
                size * Math.sin((i * Math.PI) / 3)
              );
            }
            display.closePath();
          },
          fill: color, stroke: color, strokeWidth: 2,
          centerX: am5.p50, centerY: am5.p50
        });
      } else if (ctx.shape === "square") {
        shape = am5.Graphics.new(root, {
          draw: function (display) {
            display.moveTo(-size, -size);
            display.lineTo(size, -size);
            display.lineTo(size, size);
            display.lineTo(-size, size);
            display.closePath();
          },
          fill: color, stroke: color, strokeWidth: 2,
          centerX: am5.p50, centerY: am5.p50
        });
      } else if (ctx.shape === "diamond") {
        shape = am5.Graphics.new(root, {
          draw: function (display) {
            display.moveTo(0, -size);
            display.lineTo(size, 0);
            display.lineTo(0, size);
            display.lineTo(-size, 0);
            display.closePath();
          },
          fill: color, stroke: color, strokeWidth: 2,
          centerX: am5.p50, centerY: am5.p50
        });
      } else if (ctx.shape === "triangle") {
        shape = am5.Graphics.new(root, {
          draw: function (display) {
            display.moveTo(0, -size);
            display.lineTo(size, size);
            display.lineTo(-size, size);
            display.closePath();
          },
          fill: color, stroke: color, strokeWidth: 2,
          centerX: am5.p50, centerY: am5.p50
        });
      } else {
        shape = am5.Circle.new(root, {
          radius: size,
          fill: color, stroke: color, strokeWidth: 2,
          centerX: am5.p50, centerY: am5.p50
        });
      }

      node.children.push(shape);
      ev.target.dataItem.setPrivate("radius", size);
    });

    // Charger data
    series.data.setAll([data]);
    series.set("selectedDataItem", series.dataItems[0]);
    series.appear(1000, 100);

    // Export PNG
    var exporting = am5plugins_exporting.Exporting.new(root, {
      menu: am5plugins_exporting.ExportingMenu.new(root, {}),
      filePrefix: "force_directed"
    });

  }); // end am5.ready
  </script>
</body>
</html>
